<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>
  body {
    background: url('./images/bg.jpg')
    repeat fixed;
    background-size:cover;
    overflow:scroll;
    padding: 100px;
    width: 1400px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family: 'Raleway', sans-serif;
    color: #121212;
  }
  h1, h2, h3, h4 {
    font-family: 'Raleway', sans-serif;
  }
  .results {
  border: 1px solid black;
  border-collapse: collapse;
}
table, tr, td {
  padding: 12px;
}
</style>
<title>CS 184 Final Report</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>


<body>

<h1 align="middle" style="color:white;">CS 184: Computer Graphics and Imaging, Spring 2021</h1>
<h1 align="middle" style="color:white;">Final Report: Music-reactive Real-time Fire Simulation</h1>
<h2 align="middle" style="color:white;">Henry Allen, Priyanka Kargupta, Hannah Ku, Amber Xie</h2>

<br><br>

<div style="background-color: #ffffffeb; padding:40px; border-radius: 25px;">

<h2 align="middle">Summary</h2>
<p>
  In this project, we created an audio visualizer using fire simulations that react to change in features in music like frequency, danceability, and tempo. We created a set of realistic fires that change in color, amplitude, and velocity due to the aforementioned music feature changes. We are able to connect locally uploaded music files and results from the Spotify API to make the simulation interactive.
</p>


<h2 align="middle">Technical Approach:</h2>
<h3 align="middle">Fire Particle System</h3>

<center><img src="./images/particle_system.png" align="middle" height="300px"style="float:right;" /></center>
<p>
  For our basic fire system, we worked off an <a href="https://github.com/simondevyoutube/ThreeJS_Tutorial_ParticleSystems">existing particle system demo</a>. This simulation simulated flames shooting out of a rocket, so we had to make some fundamental changes to what the particle system looked like. We used this diagram to the right to determine the different steps in rendering a particle system.
</p>
<p>First, to represent the particles, we decreased the average size of the particles and increased the number of particles added at every timestep in order to make the particles less noticeable and the entire system more dynamic and realistic. We set an initial opacity and color that mimicks the color of the fire, and we randomly generate lifespans. We also set an initial velocity so that the fire does not shoot up unrealistically, nor does it stay so low as to be completely uninteresting.
</p>
<p>
  Second, to update the particle, we update both its attributes and position. For its appearance attributes, we slowly decrease the alpha value the particle fades as it reaches the top of the fire. Then, we update its next location. This involves many forces: rotation, so that particles spin around to create more stoachasticity; gravity; drag; and pressure points. While gravity and drag improve the rendering of the particle system, we found that the fire was not as realistic as we desired, since there was no flickering of flames like in real fires. Thus, we spawned randomly generated pressure points that attract particles nearby. These pressure points are also particles, but they have a different lifespan and do not change positions until their lifespan is used up and a new point is randomly generated to take its place.
</p>
<br>

<h3 align="middle">Fire Fluid System</h3>
<p>
  TODO
</p>

<h3 align="middle">Smoke</h3>
<p>
  TODO
</p>

<h3 align="middle">Embers</h3>
<p>
  TODO
</p>

<h3 align="middle">Music Analysis</h3>
<p>
  Once we connected the fires with the music, we had various stylistic and technical choices. First, we had to decide how to visualize the music. For this, we used TODO: write more about get byte frequencies. After using the FFT, we chose a number of frequencies to represent. We found that higher frequencies are very sensitive and are not very interesting to look at, so to determine which frequency to look at, we used an exponential function that takes in the fire index and returned an index of the FFT array. This ensured that more of the fires reflected lower frequencies, while were still a few that captured the higher frequencies.
</p>
<p>
  Then, we had to make some design choices about the fire. In order to freflect a higher magnitude of a frequency, we chose to increase the velocity and lifespan of particles in that fire. That meant the fire would be much taller than the other fires. We encountered various problems trying to make the fire look realistic at various heights while also not being too computationally expensive. At the end, we settled on a range of parameters that seemed appropriate and balanced our main concerns.
</p>
<p>
  Finally, we had some fun with incorporating parts of the Spotify API to make the fires more interactive. Based on the danceability and energy of tracks, we changed the colors of the fire particles and smoke particles. The lower the energy of the track, the lighter the smoke would be. Low danceability also corresponded to bluer flames; medium danceability to green flames; and high danceability to red flames. In order to achieve this effect, we changed the color values, which are interpolated throughout the lifespan of the particle. Thus, a particle can start out as a more saturated blue and slowly fade. [TODO: not sure if this is correct]
</p>

<h3 align="middle">Misc</h3>
<p>
  TODO
</p>

<h2 align="middle">Results:</h2>

<p>
  TODO: Videos, images, etc.
</p>



<h2 align="middle">References</h2>
<ul>
  <li>Software Resources</li>
  <ul>
    <li>WebGL (Three.js)</li>
    <li>Spotify API</li>
    <li>Music MP3s</li>
  </ul>
  <li>Hardware</li>
  <ul>
    <li>Laptops</li>
  </ul>
  <li>Links TODO Update</li>
  <ul>
    <li><a href="http://ryansumner.github.io/FireParticles/">OpenGL Particles</a></li>
    <li><a href="https://cs184-firesim.github.io/final-report/"></a>Previous year's report</li>
    <li><a href="https://learnopengl.com/In-Practice/2D-Game/Particles">OpenGL Particles</a></li>
    <li><a href="https://developer.spotify.com/documentation/web-api/reference/#endpoint-get-audio-analysis">Spotify API Audio Analysis</a></li>
    <li><a href="http://www.sci.utah.edu/~vpegorar/research/2006_EGWNP.pdf">Research</a></li>
    <li><a href="http://graphics.ucsd.edu/~henrik/papers/fire/fire.pdf">Physics-Based Fire</a></li>
    <li><a href="https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-30-real-time-simulation-and-rendering-3d-fluids">3D Rendering</a></li>
  </ul>
</ul>
<h2 align="middle">Contributions</h2>
<p>
  Henry:
  <br>
  Priyanka:
  <br>
  Hannah:
  <br>
  Amber:
</p>
</body>
</html>
